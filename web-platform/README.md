# C Programming Online Judge Platform

åœ¨çº¿ C è¯­è¨€ç¼–ç¨‹å­¦ä¹ ä¸è¯„æµ‹å¹³å°ï¼ŒåŸºäº Next.js + PostgreSQL + Dockerã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd web-platform
npm install
```

### 2. å¯åŠ¨å®Œæ•´æœåŠ¡ï¼ˆæ¨èï¼‰

```bash
# ä¸€é”®å¯åŠ¨ PostgreSQL + åˆ¤é¢˜æœåŠ¡
./scripts/start-all.sh
```

### 3. å¯åŠ¨ Web æœåŠ¡

```bash
npm run dev
```

è®¿é—® http://localhost:3000 å¼€å§‹ä½¿ç”¨ï¼

## ğŸ“ é¡¹ç›®ç»“æ„

```
web-platform/
â”œâ”€â”€ docker-compose.yml      # Docker Compose é…ç½®
â”œâ”€â”€ database/
â”‚   â””â”€â”€ init.sql           # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ judge/                  # åˆ¤é¢˜æœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile         # åˆ¤é¢˜ç¯å¢ƒé•œåƒ
â”‚   â”œâ”€â”€ server.py          # HTTP åˆ¤é¢˜æœåŠ¡
â”‚   â””â”€â”€ run_job.py         # åˆ¤é¢˜æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma      # æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ submit/    # æäº¤ API
â”‚   â”‚   â”‚   â”œâ”€â”€ problems/  # é¢˜ç›® API
â”‚   â”‚   â”‚   â””â”€â”€ courses/   # è¯¾ç¨‹ API
â”‚   â”‚   â”œâ”€â”€ courses/       # è¯¾ç¨‹åˆ—è¡¨é¡µ
â”‚   â”‚   â””â”€â”€ ide/           # IDE ç¼–è¾‘é¡µ
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ CodeEditor.tsx   # Monaco ä»£ç ç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ ConsolePanel.tsx # æ§åˆ¶å°é¢æ¿
â”‚   â”‚   â””â”€â”€ IDEWorkspace.tsx # IDE å·¥ä½œåŒº
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ db.ts            # Prisma å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ problem-service.ts # é¢˜ç›®æœåŠ¡
â”‚       â”œâ”€â”€ courses.ts       # è¯¾ç¨‹é…ç½®ï¼ˆé™æ€ fallbackï¼‰
â”‚       â””â”€â”€ problems.ts      # é¢˜ç›®é…ç½®ï¼ˆé™æ€ fallbackï¼‰
â””â”€â”€ scripts/
    â”œâ”€â”€ start-all.sh       # ä¸€é”®å¯åŠ¨è„šæœ¬
    â””â”€â”€ start-judge.sh     # ä»…å¯åŠ¨åˆ¤é¢˜æœåŠ¡
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æŠ€æœ¯æ ˆ

| å±‚ | æŠ€æœ¯ |
|---|-----|
| å‰ç«¯ | Next.js 15, React 19, TypeScript, TailwindCSS |
| ç¼–è¾‘å™¨ | Monaco Editor |
| åç«¯ | Next.js API Routes |
| æ•°æ®åº“ | PostgreSQL 15 + Prisma ORM |
| åˆ¤é¢˜ | Python Flask + GCC (Docker) |
| å®¹å™¨ | Docker Compose |

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æµè§ˆå™¨                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Next.js Web æœåŠ¡                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è¯¾ç¨‹é¡µé¢   â”‚  â”‚  IDE é¡µé¢   â”‚  â”‚      API Routes     â”‚  â”‚
â”‚  â”‚ /courses    â”‚  â”‚ /ide/[id]   â”‚  â”‚ /api/submit         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ /api/problems       â”‚  â”‚
â”‚                                     â”‚ /api/courses        â”‚  â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                         â”‚
                    â–¼                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   PostgreSQL      â”‚     â”‚   åˆ¤é¢˜æœåŠ¡         â”‚
        â”‚   (é¢˜ç›®/æäº¤)      â”‚     â”‚   :9090           â”‚
        â”‚   :5432           â”‚     â”‚   Python + GCC    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚   é¢˜ç›®èµ„æºç›®å½•     â”‚
                                  â”‚   /resources      â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ¤é¢˜æµç¨‹

```
1. ç”¨æˆ·æäº¤ä»£ç 
        â†“
2. API éªŒè¯ + åˆ›å»ºæäº¤è®°å½• (PostgreSQL)
        â†“
3. å†™å…¥ä¸´æ—¶ç›®å½• + è°ƒç”¨åˆ¤é¢˜æœåŠ¡ (HTTP)
        â†“
4. åˆ¤é¢˜æœåŠ¡ç¼–è¯‘è¿è¡Œ (Docker å®¹å™¨å†…)
        â†“
5. è¿”å›ç»“æœ + æ›´æ–°æäº¤è®°å½•
        â†“
6. å‰ç«¯æ˜¾ç¤ºç»“æœ
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨

| è¡¨ | è¯´æ˜ |
|---|-----|
| `stages` | è¯¾ç¨‹é˜¶æ®µ |
| `modules` | å­¦ä¹ æ¨¡å— |
| `problems` | é¢˜ç›® |
| `judge_configs` | åˆ¤é¢˜é…ç½® |
| `quiz_configs` | Quiz é…ç½® |
| `submissions` | æäº¤è®°å½• |

### é¢˜ç›®ç±»å‹

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `text_exact` | æ–‡æœ¬ç²¾ç¡®åŒ¹é… | 00_hello |
| `compile_run` | ç¼–è¯‘è¿è¡Œæ£€æŸ¥è¾“å‡º | 04_compile |
| `code_with_grader` | å¸¦éšè—æµ‹è¯•çš„ä»£ç é¢˜ | 02_code1, 16_subseq |
| `link_object` | é“¾æ¥ .o æ–‡ä»¶ç¼–è¯‘ | 05_squares |
| `makefile_project` | Makefile é¡¹ç›® | 06_rect |
| `reading` | é˜…è¯»ç†è§£é¢˜ | 11_read_ptr1 |
| `testgen` | æµ‹è¯•ç”Ÿæˆé¢˜ | 08_testing |
| `quiz` | é€‰æ‹©/å¡«ç©ºé¢˜ | qz_c_basics_mcq_1 |

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°é¢˜ç›®

ç°åœ¨ä½¿ç”¨æ•°æ®åº“ç®¡ç†é¢˜ç›®ï¼Œæ¨èé€šè¿‡ SQL æˆ–ç®¡ç†ç•Œé¢æ·»åŠ ï¼š

```sql
-- 1. æ’å…¥é¢˜ç›®
INSERT INTO problems (id, module_id, title, description_zh, problem_type, display_type, difficulty, points, editable_files, resource_path) 
VALUES ('new_problem', 'module-2', 'æ–°é¢˜ç›®', '# é¢˜ç›®æè¿°...', 'compile_run', 'standard', 'basic', 20, '["main.c"]', 'new_problem');

-- 2. æ’å…¥åˆ¤é¢˜é…ç½®
INSERT INTO judge_configs (problem_id, config, main_file, expected_output)
VALUES ('new_problem', '{"type": "compile_run"}', 'main.c', 'Hello\n');
```

### ç¯å¢ƒå˜é‡

```bash
# .env
DATABASE_URL=postgresql://cjudge:cjudge_dev_password@localhost:5432/cjudge
JUDGE_SERVICE_URL=http://localhost:9090
USE_DOCKER_SERVICE=true   # è®¾ä¸º false å¯è·³è¿‡ Docker åˆ¤é¢˜
USE_DATABASE=true         # è®¾ä¸º false å¯ä½¿ç”¨é™æ€é…ç½®
```

### Prisma å‘½ä»¤

```bash
# ç”Ÿæˆå®¢æˆ·ç«¯
npx prisma generate

# æŸ¥çœ‹æ•°æ®åº“
npx prisma studio

# åŒæ­¥ schema åˆ°æ•°æ®åº“
npx prisma db push

# é‡ç½®æ•°æ®åº“
npx prisma db push --force-reset
```

## ğŸ³ Docker å‘½ä»¤

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# ä»…æŸ¥çœ‹åˆ¤é¢˜æœåŠ¡æ—¥å¿—
docker-compose logs -f judge

# é‡æ–°æ„å»º
docker-compose build --no-cache

# åœæ­¢æœåŠ¡
docker-compose down

# æ¸…ç†ï¼ˆåŒ…æ‹¬æ•°æ®å·ï¼‰
docker-compose down -v
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡å¯åŠ¨**ï¼š`init.sql` ä¼šè‡ªåŠ¨åˆ›å»ºè¡¨å’Œåˆå§‹æ•°æ®

2. **M1/M2 Mac**ï¼šåˆ¤é¢˜é•œåƒä½¿ç”¨ `--platform linux/amd64`ï¼Œé¦–æ¬¡æ„å»ºè¾ƒæ…¢

3. **é¢˜ç›®èµ„æº**ï¼šåˆ¤é¢˜æœåŠ¡æŒ‚è½½é¡¹ç›®æ ¹ç›®å½•ä¸º `/resources`

4. **å¼€å‘æ¨¡å¼**ï¼šè®¾ç½® `USE_DATABASE=false` å¯ä½¿ç”¨é™æ€é…ç½®ï¼Œæ— éœ€æ•°æ®åº“

## ğŸ”§ æ•…éšœæ’é™¤

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ PostgreSQL çŠ¶æ€
docker-compose ps
docker-compose logs postgres

# æ‰‹åŠ¨è¿æ¥æµ‹è¯•
docker-compose exec postgres psql -U cjudge -d cjudge
```

### åˆ¤é¢˜æœåŠ¡æ— å“åº”

```bash
# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:9090/health

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs judge
```

### Prisma ç±»å‹é”™è¯¯

```bash
# é‡æ–°ç”Ÿæˆå®¢æˆ·ç«¯
npx prisma generate

# å¦‚æœ schema å˜æ›´
npx prisma db push
```
